<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Native Development for the ESP8266 Using Sming &middot; Tristan's Tech Blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-custom-0">
  <!-- <body> -->


    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Tristan's Tech Blog
        </a>
      </h1>
      <p class="lead"></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archive</a>
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      


<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

      <!-- <a class="sidebar-nav-item" href="https://github.com/treemantris/archive/v2.1.0.zip">Download</a>
      <a class="sidebar-nav-item" href="https://github.com/treemantris">GitHub project</a>
      <span class="sidebar-nav-item">Currently v2.1.0</span> -->
    </nav>
    
    <p>&copy; 2015. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Native Development for the ESP8266 Using Sming</h1>
  <span class="post-date">12 Nov 2015</span>
  <p>In previous posts, I&#39;ve talked about <a href="/2015/09/09/adding-wifi-to-your-hardware-projects-esp8266/">using the ESP8266 module to add WiFi to hardware projects</a>. The ESP8266 is a neat little chip, and recently I&#39;ve spent some time learning how to write native programs for it, ie - code that runs directly on the ESP8266 itself without having to connect it to an Arduino.</p>

<p>I&#39;ve been using <a href="https://github.com/SmingHub/Sming">Sming</a>, an open source framework built on top of the official <a href="http://espressif.com/new-sdk-release/">Espressif SDK</a>. Sming makes writing native applications a breeze, and supports most existing Arduino libraries which means that you can connect and use almost any sensor/device that works with Arduino!</p>

<p>Although documentation is a bit sparse, I followed the <a href="https://github.com/SmingHub/Sming/wiki/Windows-Quickstart">Windows Quickstart</a> for setting it up and had no problems at all. Where it lacks in documentation, it easily makes up in code examples, with dozens of example projects to get you started. The framework, and the applications you build with it, are written in C++. With my C++ being a bit rusty, I found the exmpales a great way to learn the API and brush up on areas of C++ that I am not overly familiar with (mostly templates).</p>

<p>To create a new project, I copied the folder for one of the example projects, renamed it and then imported it into Eclipse. After reading through example uses of the TcpServer class, and modifying the TcpClient example project a little, I was able to successfully write a simple echo-server, which accepts TCP connections on port 123, and sends back any data sent to it. The code is as follows:</p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cp">#include &lt;user_config.h&gt;
#include &lt;SmingCore/SmingCore.h&gt;
</span>
<span class="cp">#define WIFI_SSID "MY_WIFI_SSID"
#define WIFI_PWD "MY_WIFI_PASSWORD"
</span>
<span class="n">TcpServer</span> <span class="n">myTcpServer</span><span class="p">;</span>

<span class="n">bool</span> <span class="nf">onClientData</span><span class="p">(</span><span class="n">TcpClient</span><span class="o">&amp;</span> <span class="n">client</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">client</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">connectedToWifi</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Connected!"</span><span class="p">);</span>

    <span class="n">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">WifiStation</span><span class="p">.</span><span class="n">getIP</span><span class="p">().</span><span class="n">toString</span><span class="p">();</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">ip</span><span class="p">);</span>

    <span class="n">myTcpServer</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">123</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">connectFail</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Connect failed, retrying"</span><span class="p">);</span>
    <span class="n">WifiStation</span><span class="p">.</span><span class="n">waitConnection</span><span class="p">(</span><span class="n">connectedToWifi</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">connectFail</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>

    <span class="n">myTcpServer</span> <span class="o">=</span> <span class="n">TcpServer</span><span class="p">(</span><span class="n">onClientData</span><span class="p">);</span>
    <span class="n">WifiAccessPoint</span><span class="p">.</span><span class="n">enable</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
    <span class="n">WifiStation</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">WIFI_SSID</span><span class="p">,</span> <span class="n">WIFI_PWD</span><span class="p">);</span>
    <span class="n">WifiStation</span><span class="p">.</span><span class="n">enable</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>

    <span class="n">WifiStation</span><span class="p">.</span><span class="n">waitConnection</span><span class="p">(</span><span class="n">connectedToWifi</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">connectFail</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

<p>It consists of four simple methods: <code>init()</code> runs once after the device has started up, and initialises the connection to my local wifi network. <code>connectedToWifi()</code> gets called when the WiFi connection is established, starts the TCP server listening on port 123, and prints out the IP address to the serial connection. <code>connectFail()</code> gets called on failure to connect to the WiFi and attempts to re-connect. <code>onClientData()</code> get calls when a connected client sends us data over the TCP socket which we send directly back to the conected client.</p>

<p>Getting the code onto the device itself is a bit fiddly, you&#39;ll need a USB to TTL adapter, and then it&#39;s just a matter of <a href="http://www.esp8266.com/wiki/doku.php?id=getting-started-with-the-esp8266">wiring everything up</a> and flashing it. To flash code onto the ESP8266 you&#39;ll need to either run <code>make flash</code> from the command line or select the flash option from the Make Targets menu in Eclipse.</p>

<p>With the basics sorted, it should be easy enough to port some of my existing Arduino projects to native ESP8266. Doing so for the sous-vide project would be really cool, as it would open up the possiblity of controlling it from a smartphone via WiFi. I&#39;m also looking into clustering several ESP8266 to see if I can implement some interesting distributed algorithms, more on that soon.</p>

<a href="https://twitter.com/share" class="twitter-share-button" data-via="TristanPollitt" data-size="large" data-count="none" data-dnt="true">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


<!-- <div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2015/09/13/building-a-nest-thermostat-with-arduino-part1/">
            Building a Nest Thermostat With Arduino Part 1 - Control
            <small>13 Sep 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/09/09/adding-wifi-to-your-hardware-projects-esp8266/">
            Adding WiFi to Your Hardware Projects Using The ESP8266
            <small>09 Sep 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/08/29/building-a-simple-sous-vide-cooker-using-arduino/">
            Building a Simple Sous-Vide Cooker Using Arduino
            <small>29 Aug 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div> -->



  
  <a name="comments"></a>
  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'tristanstechblog';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  
</div>



    </div>

  </body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67824878-1', 'auto');
  ga('send', 'pageview');

</script>
</html>
